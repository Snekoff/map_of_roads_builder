<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #stage {
            width: 2002px;
            height: 1002px;
            position: relative;
            border: 2px solid black;
        }

        .layer {
            border: 1px solid #000000;
        }

        canvas {
            position: absolute;
        }

        #game-layer {
            z-index: 3;
        }

        #vertices-layer {
            z-index: 2;
        }

        #background-layer {
            z-index: 1;
        }

        input {
            height: 50px;
            width: 100px;
        }

        input[type="file"] {
            height: 50px;
            width: 250px;
        }

        input[type="text"] {
            height: 44px;
            width: 100px;
        }

        button {
            height: 50px;
            width: 100px;
        }

        div {
            margin-top: 5px
        }

        form {
            margin-top: 5px
        }
    </style>
</head>
<body>

<br>
<div id="stage">
    <!--game-layer contains roads between vertices and text for now-->
    <!--TODO: rebase vertices text to vertices layer if debugging is finished-->
    <canvas class="layer" id="background-layer" width="2000" height="1000" ></canvas>
    <canvas class="layer" id="vertices-layer" width="2000" height="1000" ></canvas>
    <canvas class="layer" id="game-layer" width="2000" height="1000" ></canvas>
</div>

<div id="buttons">
    <input type="button" value="start NEW" id="start">
    <input type="text" value="0" id="vertices1">
    <input type="text" value="0" id="edges1">
    <input type="button" value="next step" id="next_step">
    <input type="button" value="save" id="save">
<!--    <input type="button" value="classes functions"  id="cFunctions">-->
    <!--<input type="button" value="map" id="map">-->
</div>



<form id="upload">
    <label for="file" style="margin-left: 2px; margin-right: 83px">File to upload</label>
    <input type="file" id="file" accept=".json">

    <button>load</button>
</form>


<script type="module">
    import {DrawingLogic} from "./src/drawing_logic.js";
    import * as saveAndLoad from "./src/save_and_load_logic.js";
    import {MapLogic} from "./src/map/map_logic.js";

    import {Graph} from "./src/graph/graph.js";
    import {Vertice} from "./src/graph/vertice.js";
    import {Drawing} from "./src/drawing.js";

    let background = document.querySelector('#background-layer')
    let drawingLogic = new DrawingLogic(0, 0, background.width, background.height);
    let graph;
    document.getElementById("start").addEventListener('click', () => {
        graph = drawingLogic.initialVerticesEdgesShow();
    })

    document.getElementById("next_step").addEventListener('click', () => {
        graph = drawingLogic.buildEdgesAndUpdateView(graph);
    })

    document.getElementById("save").addEventListener('click', () => {
        saveAndLoad.save(graph, drawingLogic, drawingLogic.mapLogic);
    })

    let form = document.querySelector('#upload');
    form.addEventListener('submit', saveAndLoad.load);
    console.log("--SaveAndLoadLogic--");

    form.addEventListener('submit', () => {
        setTimeout(() => {
            graph = saveAndLoad.getLoadedGraph();
            drawingLogic = saveAndLoad.getLoadedDrawingLogic();
            drawingLogic.graph = graph;
            drawingLogic.mapLogic.graph = graph;
            graph.mapLogic = drawingLogic.mapLogic;


            console.log("graph", graph);
            console.log("drawingLogic", drawingLogic);
            console.log("drawingLogic.mapLogic", drawingLogic.mapLogic);
            drawingLogic.draw.drawBackgroundImage(0, 0);
            drawingLogic.draw.drawVerticesGraphics(graph);
            drawingLogic.draw.drawEdgesAndVerticesTextOnCanvas(graph);
        }, 100)
    })

    /*document.getElementById("map").addEventListener('click', () => {
        let background = document.querySelector('#background-layer');
        let map = new MapLogic(0, 0, background.width, background.height, graph);
        let result = map.bfsFromOneVerticeToAnother(17, 0, graph);
        drawingLogic.draw.lineFromArr(result.route);
    })*/

    /*document.getElementById("cFunctions").addEventListener('click', () => {
        console.log(document.getElementById(`${document.getElementById("city").value}`).innerText);
    })*/


</script>


</body>
</html>